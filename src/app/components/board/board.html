<div
  class="board-outer"
  [class.labels-off]="store.fullScreenBoard()"
>

  <!-- overlay while generating -->
  @if (store.busy()) {
  <div
    class="loading-overlay"
    aria-live="polite"
  >
    <mat-progress-spinner
      mode="indeterminate"
      diameter="48"
    ></mat-progress-spinner>
    <div class="txt">Building puzzleâ€¦</div>
  </div>
  }

  @if (!store.fullScreenBoard()) {
  <div class="col-labels">
    <div class="corner"></div>
    @for (c of cols; track $index) {
    <div class="col-label">{{ c+1 }}</div>
    }
  </div>
  }


  <div class="row">
    @if (!store.fullScreenBoard()) {
    <div class="row-labels">
      @for (r of rows; track $index) {
      <div class="row-label">{{ rowLetter(r) }}</div>
      }
    </div>
    }

    <div
      class="board"
      role="grid"
      tabindex="0"
      (click)="focusBoard()"
      [class.reveal]="store.reveal()"
      [class.flash-active]="store.flashActive()"
      [class.win]="!!store.win()"
      [class.review]="store.reviewMode()"
      [style.--ox]="store.win() ? ( (store.win()!.c + 0.5) / 9 * 100 ) + '%' : null"
      [style.--oy]="store.win() ? ( (store.win()!.r + 0.5) / 9 * 100 ) + '%' : null"
    >

      <div
        class="points-layer"
        aria-hidden="true"
      >
        @for (f of store.floaters(); track f.id) {
        <span
          class="points-f"
          [class.neg]="Number(f.text) < 0"
          [style.--row]="f.r"
          [style.--col]="f.c"
        >{{ Number(f.text) > 0 ? '+' : ''}}{{ Number(f.text) }}</span>
        }
      </div>

      @if (store.win()) {
      <div class="win-badge">Solved!</div>
      <div class="confetti">
        @for (i of confetti; track $index) { <i [style.--i]="$index"></i> }
      </div>
      }

      <div class="grid">
        @for (r of rows; track $index) {
        <div
          class="row"
          role="row"
        >
          @for (c of cols; track $index) {
          <button
            class="cell"
            role="gridcell"
            [ngClass]="cellClasses(r,c)"
            [class.readonly]="isGiven(r,c) && !store.editingGivenMode()"
            [attr.aria-disabled]="(isGiven(r,c) && !store.editingGivenMode()) || store.reviewMode() ? 'true' : null"
            (click)="onCellClick(r,c)"
            (mouseenter)="onHover(r,c,true)"
            (mouseleave)="onHover(r,c,false)"
            [attr.aria-selected]="isSelected(r,c)"
            [attr.aria-label]="ariaLabel(r,c)"
            [attr.aria-disabled]="isGiven(r,c) && !store.editingGivenMode() ? 'true' : null"
            [style.--r]="r"
            [style.--c]="c"
            [class.unit-flash]="hasFlashAt(r,c)"
            [style.--delay]="flashDelay(r,c)"
          >

            @if (hasValue(r,c)) {
            <span class="val">{{ cellValue(r,c) }}</span>
            } @else {
            <div class="pencil">
              @for (d of digits; track $index) {
              <span
                class="p"
                [class.on]="hasCand(r,c,d)"
                [class.cand-match]="candMatchesActive(r,c,d)"
                [class.cand-hint]="candInHint(r,c,d)"
              >{{ d }}</span>
              }
            </div>
            }
          </button>
          }
        </div>
        }
      </div>
    </div>
  </div>
</div>
