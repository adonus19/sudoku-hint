<div class="play-wrap safe-bottom">
  <div class="hud">
    <div class="cell left">
      <div
        class="hud-item score"
        [class.bump]="store.scoreBump()"
      >{{ store.score() }}</div>
    </div>
    <div class="cell center">
      <div class="hud-item diff">{{ (store.rating()?.bucket || '—') | titlecase }}</div>
    </div>
    <div class="cell right">
      <div class="hud-item time">{{ store.timerLabel() }}</div>
      <button
        class="hud-item pause"
        mat-icon-button
        (click)="openPause()"
        aria-label="Pause"
      >
        <mat-icon>pause</mat-icon>
      </button>
    </div>
  </div>

  <!-- REMOVE the old .controls block entirely -->

  <div class="board-wrap">
    <app-board></app-board>
  </div>

  <!-- Start Solving bar (visible only during given mode) -->
  @if (store.editingGivenMode()) {
  <div
    class="start-bar"
    role="region"
    aria-label="Start solving"
  >
    <div class="msg">
      Setup mode — tap Start when you’ve finished entering givens.
      @if (!store.hasAnyValues()) {
      <span class="warn">Please enter at least one value to begin.</span>
      }
      @if (store.conflicts().cells.size) {
      <span class="warn">There are conflicts in the givens.</span>
      }
    </div>
    <button
      mat-flat-button
      color="primary"
      class="start-btn"
      (click)="startSolving()"
      [disabled]="!store.hasAnyValues() || store.conflicts().cells.size > 0"
    >
      Start
    </button>
  </div>
  }

  <!-- NEW: tools row under board, above keypad -->
  <div
    class="tools"
    role="toolbar"
    aria-label="Board tools"
  >
    <button
      class="tool ghost tool--reset"
      type="button"
      (click)="store.resetPencils()"
      aria-label="Reset pencils"
    >
      <mat-icon class="ic">layers_clear</mat-icon>
      <span class="lbl">Reset Pencils</span>
    </button>

    <button
      class="tool ghost tool--undo"
      type="button"
      (click)="undo()"
      aria-label="Undo"
    >
      <mat-icon class="ic">undo</mat-icon>
      <span class="lbl">Undo</span>
    </button>

    <button
      class="tool ghost tool--erase"
      type="button"
      (click)="erase()"
      aria-label="Erase"
    >
      <mat-icon class="ic">backspace</mat-icon>
      <span class="lbl">Erase</span>
    </button>

    <button
      class="tool ghost tool--pencil"
      type="button"
      (click)="togglePencil()"
      [attr.aria-pressed]="store.pencilMode()"
    >
      <mat-icon class="ic">edit_note</mat-icon>
      <span class="lbl">Pencil</span>
      <span
        class="badge"
        [class.on]="store.pencilMode()"
      >{{ store.pencilMode() ? 'ON' : 'OFF' }}</span>
    </button>

    <button
      class="tool ghost tool--hint"
      type="button"
      (click)="openHint()"
      aria-label="Hint"
    >
      <mat-icon class="ic">lightbulb</mat-icon>
      <span class="lbl">Hint</span>
    </button>
  </div>

  <app-number-pad class="pad"></app-number-pad>

  <div
    class="ad-reserve"
    aria-hidden="true"
  ></div>
</div>
